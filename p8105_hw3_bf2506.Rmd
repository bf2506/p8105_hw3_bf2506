---
title: "p8105_hw3_bf2506.Rmd"
output: github_document
date: "2022-10-10"
---
```{r load package, message=FALSE, warning=FALSE}
library(tidyverse)
```

### Problem 2
##### Load, tidy, and wrangle accel_data
```{r read, message=FALSE, warning=FALSE}
accel_data = 
  read.csv("./data/accel_data.csv") %>% 
  janitor::clean_names() %>% 
  mutate(weekday_vs_weekend = ifelse(day == c("Saturday", "Sunday"), "weekend", "weekday")) %>% 
  select(week, day_id, day, weekday_vs_weekend, everything())

```
**Describe the accel_data**
There are 2595176 observations and 7 variables. <br>
Variables: "week", "day_id", "day", "weekday_vs_weekend", "activity_*"(from "activity_1" to "activity_1440") <br>

##### Traditional analyses of accel_data

```{r create a total activity variable for each day}
accel_data = 
  mutate(accel_data, total_activity = rowSums(accel_data[5:1444])) %>% 
  select(week, day_id, day, weekday_vs_weekend, total_activity, everything())
```

```{r create new total table }
total_activity_table =
  select(accel_data, week, day_id, day, weekday_vs_weekend, total_activity) %>% 
  mutate(day = fct_relevel(day, c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))) %>% 
  arrange(week, day)

df = 
  select(total_activity_table, total_activity)
```
**Trend**
The man is more active from week 1 to week 3, and is less active from week 4 to week 5. On average, he is more active on Friday. Considering the two outliers data we found on Saturday in week 4 and week 5, there may be some mistakes. But there is no obvious monotonically increasing or decreasing trend.

##### Make a single-panel plot

```{r single-panel plot}
plot_df = 
   pivot_longer(
    accel_data,
    activity_1:activity_1440, 
    names_to = "activity_No", 
    values_to = "activity_counts")

hour_activity_plot = 
    ggplot(plot_df, aes(x = activity_No, y = activity_counts, color = day)) + 
  geom_point() + 
  theme(legend.position = "bottom", axis.text.x = element_blank()) + 
  labs(title = " Accelerometer Activity Counts by Day", x = "Time", y = "Activity_Counts") 

hour_activity_plot
```
**Describe the graph**
We can conclude that the man is usually active on the Friday morning and on the Sunday evening, less active on Wednesday. 

### Problem 3

```{r load dataset of noaa and package}
library(p8105.datasets)
data("ny_noaa")

library(patchwork)
```

**Describe ny_noaa ** < br >
This dataset contains 2595176 observations and 7 variables related to some weather data in New York, which are provided by NOAA. 
NA in prcp is `r sum(is.na(ny_noaa$prcp))`, <br>
NA in snow is `r sum(is.na(ny_noaa$snow))`, <br>
NA in snwd is `r sum(is.na(ny_noaa$snwd))`, <br>
NA in tmax is `r sum(is.na(ny_noaa$tmax))`, <br>
NA in tmin is `r sum(is.na(ny_noaa$tmin))`, <br>
??many stations report precipitation only.??indicating the extent to which missing data is an issue.??
The Variables are as following: <br>
      id: Weather station ID <br>
      date: Date of observation <br>
      prcp: Precipitation (tenths of mm) <br>
      snow: Snowfall (mm) <br>
      snwd: Snow depth (mm) <br>
      tmax: Maximum temperature (tenths of degrees C) <br>
      tmin: Minimum temperature (tenths of degrees C) <br>
      
##### Data cleaning
```{r clean data}
ny_noaa_df =  
  ny_noaa %>% 
  janitor::clean_names() %>% 
  separate(date, into = c("year", "month", "day"), convert = TRUE) %>% 
  mutate(tmax = as.numeric(tmax)/10, tmin = as.double(tmin)/10)
```

```{r snowfall mode}
ny_noaa_snowfall = 
  ny_noaa_df %>% 
  drop_na(snow)

```
For snowfall, `r names(table(ny_noaa_snowfall$snow))[which.max(table(ny_noaa_snowfall$snow))]` is the most commonly observed values. I think it is because, generally, snow only happens in the winter, with a 25% percentage in a year, and some places may not get snow.

##### Two-panel plot Average tmax in January and July
```{r  two-panel plot Average tmax in January / July}
Avetmax_in_Jan_and_Jul = 
  ny_noaa_df %>% 
  select(id, year, month, tmax) %>% 
  filter(month == c(1,7)) %>% 
  drop_na(tmax) %>%
  group_by(id, month, year) %>%
  summarize(
    avetmax = round(mean(tmax), digits = 2))

Avetmax_plot = 
ggplot(Avetmax_in_Jan_and_Jul, aes(x = year, y = avetmax, color = id, group = id)) + 
  geom_point(alpha = .6) +
  geom_line(alpha = .4) + 
  facet_grid(. ~ month) +
  theme(legend.position = "none")

Avetmax_plot
```
**Is there any observable / interpretable structure? Any outliers?**

#####Two-panel plot  TMAX vs TMIN and snowfall 
```{r TMAX vs TMIN plot}
tmax_tmin_plot = 
  ggplot(ny_noaa_df, aes(x = tmin, y = tmax)) + geom_hex() 

tmax_tmin_plot
```

```{r snowfall plot}
##to make r run faster, i get a new small table
snowfall_plot_df = 
  ny_noaa_df %>% 
  select(id, year, snow) %>% 
  drop_na(snow) %>% 
  filter(snow > 0 & snow < 100)

snowfall_plot = 
  ggplot(snowfall_plot_df, aes(x = year, y = snow, group = year)) + 
  geom_violin(aes(fill = year), alpha = 0.7) + 
  stat_summary(fun = "median", color = "black") +
  theme(legend.position = "none") +
  scale_x_discrete(limits = c(1981, 2010))

snowfall_plot
```

```{r two-panel plot tmax/tmin and snowfall}
(tmax_tmin_plot + snowfall_plot)
```

